<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Model Viewer - Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #0066cc;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #0066cc, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #aaa;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #0066cc;
            box-shadow: 0 0 20px rgba(0, 102, 204, 0.2);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #0066cc;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: 'â–¸';
            font-size: 24px;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            padding: 12px 16px;
            background: linear-gradient(135deg, #0066cc, #0052a3);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: left;
        }

        button:hover {
            background: linear-gradient(135deg, #0052a3, #003d7a);
            transform: translateX(4px);
        }

        button:active {
            transform: translateX(2px);
        }

        .info {
            background: rgba(0, 102, 204, 0.1);
            border-left: 3px solid #0066cc;
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 12px;
            color: #aaa;
        }

        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status.ready {
            background: #0a6b0a;
            color: #0f0;
        }

        .status.pending {
            background: #664400;
            color: #ff9900;
        }

        .console {
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .console-line {
            margin: 4px 0;
            padding: 2px 0;
        }

        .console-line.info {
            color: #0066cc;
        }

        .console-line.success {
            color: #0f0;
        }

        .console-line.error {
            color: #f00;
        }

        .console-line.warning {
            color: #ff9900;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            color: #666;
            font-size: 12px;
        }

        .feature-list {
            list-style: none;
            margin-top: 10px;
        }

        .feature-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .feature-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #0f0;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ® WebGL Model Viewer Test Suite</h1>
            <p class="subtitle">Modern 3D visualization for AoWoW</p>
        </header>

        <div class="grid">
            <!-- NPC Models -->
            <div class="card">
                <h2>NPC Models <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testNPC(1)">Test NPC #1</button>
                    <button onclick="testNPC(2)">Test NPC #2</button>
                    <button onclick="testNPC(3)">Test NPC #3</button>
                </div>
                <div class="info">
                    Loads NPC models by display ID. Falls back to cube if model not found.
                </div>
            </div>

            <!-- Item Models -->
            <div class="card">
                <h2>Item Models <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testItem(1, 1)">Item #1 (Slot 1)</button>
                    <button onclick="testItem(2, 3)">Item #2 (Slot 3)</button>
                    <button onclick="testItem(3, 5)">Item #3 (Slot 5)</button>
                </div>
                <div class="info">
                    Loads item models with equipment slot information.
                </div>
            </div>

            <!-- Character Models -->
            <div class="card">
                <h2>Character Models <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testCharacter(1, 0)">Human Male</button>
                    <button onclick="testCharacter(1, 1)">Human Female</button>
                    <button onclick="testCharacter(2, 0)">Orc Male</button>
                    <button onclick="testCharacter(2, 1)">Orc Female</button>
                </div>
                <div class="info">
                    Loads character models with race and sex customization.
                </div>
            </div>

            <!-- Object Models -->
            <div class="card">
                <h2>Object Models <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testObject(1)">Object #1</button>
                    <button onclick="testObject(2)">Object #2</button>
                    <button onclick="testObject(3)">Object #3</button>
                </div>
                <div class="info">
                    Loads game object models by display ID.
                </div>
            </div>

            <!-- Pet Models -->
            <div class="card">
                <h2>Pet Models <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testPet(1)">Pet #1</button>
                    <button onclick="testPet(2)">Pet #2</button>
                    <button onclick="testPet(3)">Pet #3</button>
                </div>
                <div class="info">
                    Loads pet models by display ID.
                </div>
            </div>

            <!-- API Tests -->
            <div class="card">
                <h2>API Tests <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="testAPI()">Test All API Methods</button>
                    <button onclick="testAnimation()">Test Animation</button>
                    <button onclick="testCameraReset()">Test Camera Reset</button>
                </div>
                <div class="info">
                    Tests viewer API methods and functionality.
                </div>
            </div>

            <!-- Performance Tests -->
            <div class="card">
                <h2>Performance <span class="status pending">BETA</span></h2>
                <div class="button-group">
                    <button onclick="testPerformance()">Benchmark Viewer</button>
                    <button onclick="testMemory()">Check Memory Usage</button>
                    <button onclick="testLoadTime()">Measure Load Time</button>
                </div>
                <div class="info">
                    Measures viewer performance metrics.
                </div>
            </div>

            <!-- Browser Info -->
            <div class="card">
                <h2>System Info <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="checkBrowserSupport()">Check Browser Support</button>
                    <button onclick="checkWebGLSupport()">Check WebGL Support</button>
                    <button onclick="showSystemInfo()">Show System Info</button>
                </div>
                <div class="info">
                    Displays browser and system compatibility information.
                </div>
            </div>

            <!-- Controls -->
            <div class="card">
                <h2>Controls <span class="status ready">READY</span></h2>
                <div class="button-group">
                    <button onclick="closeViewer()">Close Viewer</button>
                    <button onclick="clearConsole()">Clear Console</button>
                    <button onclick="showHelp()">Show Help</button>
                </div>
                <div class="info">
                    General viewer controls and utilities.
                </div>
            </div>
        </div>

        <!-- Console Output -->
        <div class="console" id="console">
            <div class="console-line info">WebGL Model Viewer Test Suite Initialized</div>
            <div class="console-line info">Ready to test. Click any button above to begin.</div>
        </div>

        <footer>
            <p>WebGL Model Viewer v1.0 | Three.js powered | Modern 3D visualization for AoWoW</p>
        </footer>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- WebGL Viewer -->
    <script src="/static/js/webgl-viewer.js"></script>

    <!-- Test Suite -->
    <script>
        const console_elem = document.getElementById('console');

        function log(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console_elem.appendChild(line);
            console_elem.scrollTop = console_elem.scrollHeight;
        }

        function clearConsole() {
            console_elem.innerHTML = '';
            log('Console cleared', 'info');
        }

        function testNPC(displayId) {
            log(`Loading NPC model #${displayId}...`, 'info');
            try {
                ModelViewer.show({
                    type: 1,
                    displayId: displayId,
                    humanoid: 1
                });
                log(`NPC #${displayId} loaded successfully`, 'success');
            } catch (error) {
                log(`Error loading NPC: ${error.message}`, 'error');
            }
        }

        function testItem(displayId, slot) {
            log(`Loading item model #${displayId} (slot ${slot})...`, 'info');
            try {
                ModelViewer.show({
                    type: 3,
                    displayId: displayId,
                    slot: slot
                });
                log(`Item #${displayId} loaded successfully`, 'success');
            } catch (error) {
                log(`Error loading item: ${error.message}`, 'error');
            }
        }

        function testCharacter(race, sex) {
            const races = ['', 'Human', 'Orc', 'Dwarf', 'Night Elf', 'Undead', 'Tauren', 'Gnome', 'Troll', '', 'Blood Elf', 'Draenei'];
            const sexes = ['Male', 'Female'];
            log(`Loading ${races[race]} ${sexes[sex]} character model...`, 'info');
            try {
                ModelViewer.show({
                    type: 16,
                    displayId: 1,
                    race: race,
                    sex: sex
                });
                log(`Character model loaded successfully`, 'success');
            } catch (error) {
                log(`Error loading character: ${error.message}`, 'error');
            }
        }

        function testObject(displayId) {
            log(`Loading object model #${displayId}...`, 'info');
            try {
                ModelViewer.show({
                    type: 2,
                    displayId: displayId
                });
                log(`Object #${displayId} loaded successfully`, 'success');
            } catch (error) {
                log(`Error loading object: ${error.message}`, 'error');
            }
        }

        function testPet(displayId) {
            log(`Loading pet model #${displayId}...`, 'info');
            try {
                ModelViewer.show({
                    type: 8,
                    displayId: displayId
                });
                log(`Pet #${displayId} loaded successfully`, 'success');
            } catch (error) {
                log(`Error loading pet: ${error.message}`, 'error');
            }
        }

        function testAPI() {
            log('Testing API methods...', 'info');
            try {
                log('Calling ModelViewer.show()...', 'info');
                ModelViewer.show({ type: 1, displayId: 1 });
                
                setTimeout(() => {
                    log('Calling ModelViewer.setAnimation()...', 'info');
                    ModelViewer.setAnimation('Attack');
                }, 1000);

                setTimeout(() => {
                    log('Calling ModelViewer.setRace()...', 'info');
                    ModelViewer.setRace(2);
                }, 2000);

                setTimeout(() => {
                    log('Calling ModelViewer.setSex()...', 'info');
                    ModelViewer.setSex(1);
                }, 3000);

                log('All API methods tested successfully', 'success');
            } catch (error) {
                log(`API test error: ${error.message}`, 'error');
            }
        }

        function testAnimation() {
            log('Testing animation system...', 'info');
            try {
                ModelViewer.show({ type: 1, displayId: 1 });
                setTimeout(() => {
                    ModelViewer.setAnimation('Walk');
                    log('Animation test completed', 'success');
                }, 500);
            } catch (error) {
                log(`Animation test error: ${error.message}`, 'error');
            }
        }

        function testCameraReset() {
            log('Testing camera reset...', 'info');
            try {
                ModelViewer.show({ type: 1, displayId: 1 });
                log('Camera reset test completed', 'success');
            } catch (error) {
                log(`Camera test error: ${error.message}`, 'error');
            }
        }

        function testPerformance() {
            log('Starting performance benchmark...', 'info');
            const startTime = performance.now();
            
            try {
                ModelViewer.show({ type: 1, displayId: 1 });
                const loadTime = performance.now() - startTime;
                log(`Viewer load time: ${loadTime.toFixed(2)}ms`, 'success');
                
                if (loadTime < 2000) {
                    log('âœ“ Performance is excellent', 'success');
                } else if (loadTime < 5000) {
                    log('âš  Performance is acceptable', 'warning');
                } else {
                    log('âœ— Performance needs optimization', 'error');
                }
            } catch (error) {
                log(`Performance test error: ${error.message}`, 'error');
            }
        }

        function testMemory() {
            log('Checking memory usage...', 'info');
            try {
                if (performance.memory) {
                    const used = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                    const limit = (performance.memory.jsHeapSizeLimit / 1048576).toFixed(2);
                    log(`Memory: ${used}MB / ${limit}MB`, 'info');
                    log(`Usage: ${((performance.memory.usedJSHeapSize / performance.memory.jsHeapSizeLimit) * 100).toFixed(1)}%`, 'info');
                } else {
                    log('Memory API not available in this browser', 'warning');
                }
            } catch (error) {
                log(`Memory check error: ${error.message}`, 'error');
            }
        }

        function testLoadTime() {
            log('Measuring load time...', 'info');
            const start = performance.now();
            
            try {
                ModelViewer.show({ type: 1, displayId: 1 });
                const end = performance.now();
                const duration = end - start;
                
                log(`Load time: ${duration.toFixed(2)}ms`, 'success');
                log(`Status: ${duration < 1000 ? 'Excellent' : duration < 2000 ? 'Good' : 'Needs optimization'}`, 'info');
            } catch (error) {
                log(`Load time test error: ${error.message}`, 'error');
            }
        }

        function checkBrowserSupport() {
            log('Checking browser support...', 'info');
            const ua = navigator.userAgent;
            
            if (ua.indexOf('Chrome') > -1) {
                log('âœ“ Chrome detected - Full support', 'success');
            } else if (ua.indexOf('Firefox') > -1) {
                log('âœ“ Firefox detected - Full support', 'success');
            } else if (ua.indexOf('Safari') > -1) {
                log('âœ“ Safari detected - Full support', 'success');
            } else if (ua.indexOf('Edge') > -1) {
                log('âœ“ Edge detected - Full support', 'success');
            } else {
                log('âš  Unknown browser - May have limited support', 'warning');
            }
        }

        function checkWebGLSupport() {
            log('Checking WebGL support...', 'info');
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    log('âœ“ WebGL is supported', 'success');
                    log(`Renderer: ${gl.getParameter(gl.RENDERER)}`, 'info');
                    log(`Vendor: ${gl.getParameter(gl.VENDOR)}`, 'info');
                } else {
                    log('âœ— WebGL is not supported', 'error');
                }
            } catch (error) {
                log(`WebGL check error: ${error.message}`, 'error');
            }
        }

        function showSystemInfo() {
            log('System Information:', 'info');
            log(`User Agent: ${navigator.userAgent}`, 'info');
            log(`Platform: ${navigator.platform}`, 'info');
            log(`Language: ${navigator.language}`, 'info');
            log(`Online: ${navigator.onLine ? 'Yes' : 'No'}`, 'info');
            log(`Screen: ${window.innerWidth}x${window.innerHeight}`, 'info');
            log(`Device Pixel Ratio: ${window.devicePixelRatio}`, 'info');
        }

        function closeViewer() {
            log('Closing viewer...', 'info');
            try {
                ModelViewer.hide();
                log('Viewer closed successfully', 'success');
            } catch (error) {
                log(`Error closing viewer: ${error.message}`, 'error');
            }
        }

        function showHelp() {
            log('=== WebGL Viewer Help ===', 'info');
            log('Mouse Controls:', 'info');
            log('  â€¢ Left Click + Drag: Rotate model', 'info');
            log('  â€¢ Right Click + Drag: Pan camera', 'info');
            log('  â€¢ Scroll Wheel: Zoom in/out', 'info');
            log('UI Controls:', 'info');
            log('  â€¢ Reset Camera: Return to default view', 'info');
            log('  â€¢ Fullscreen: Enter fullscreen mode', 'info');
            log('API Methods:', 'info');
            log('  â€¢ ModelViewer.show(options)', 'info');
            log('  â€¢ ModelViewer.hide()', 'info');
            log('  â€¢ ModelViewer.setAnimation(name)', 'info');
            log('  â€¢ ModelViewer.setRace(id)', 'info');
            log('  â€¢ ModelViewer.setSex(id)', 'info');
        }

        // Initialize
        log('WebGL Viewer Test Suite Ready', 'success');
        log('Three.js: ' + (window.THREE ? 'Loaded' : 'Not Found'), window.THREE ? 'success' : 'error');
        log('WebGL Viewer: ' + (window.ModelViewer ? 'Loaded' : 'Not Found'), window.ModelViewer ? 'success' : 'error');
    </script>
</body>
</html>
